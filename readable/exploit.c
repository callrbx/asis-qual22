#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ptrace.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <sys/user.h>
#include <sys/wait.h>
#include <unistd.h>

const char *readme = "readme";

int main()
{
    int status = 0;
    int check = 0;
    struct stat s = {0};

    pid_t pid = fork();
    if (0 == pid) // child
    {

        ptrace(PTRACE_TRACEME, 0, NULL, NULL);
        execv(readme, NULL);
        puts("exec failed");
        goto end;
    }

    char proc_file[32] = {0};

    snprintf(proc_file, 32, "/prod/%d/mem\00", pid);

    printf("Proc file: %s", proc_file);

    if (-1 == stat(proc_file, &s))
    {
        perror("failed to stat file:");
        goto end;
    }

    waitpid(pid, &status, 0);

end:
    return status;
}