#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/user.h>
#include <sys/wait.h>
#include <unistd.h>

const char *readme = "/home/pwn/readme";

int main()
{
    int status = 0;
    int check = 0;
    struct user_regs_struct regs;

    pid_t pid = fork();
    if (0 == pid) // child
    {
        pid = fork();
        if (0 == pid)
        {
            ptrace(PTRACE_TRACEME, 0, NULL, NULL);
            execv(readme, NULL);
            puts("exec failed");
            goto end;
        }
        else
        {
            wait(NULL);

            printf("Child PID: %d\n", pid);

            ptrace(PTRACE_O_TRACEFORK, pid, 0, 0);

            printf("RIP: %llp\n", regs.rip);

            puts("here");
        }
    }

    waitpid(pid, &status, 0);

end:
    return status;
}